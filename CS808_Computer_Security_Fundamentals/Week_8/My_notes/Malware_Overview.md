# Malware Overview

Malware is a specific type of software which has been designed to complete malicious activity on the infected computer system. 

Malware can complete a range of activities such as:
* **Ransomware:** 
    * encrypting data and requesting money for the data to be decrypted
    * e.g. see the Wannacry malware
* **Spyware:** 
    * monitoring data and sending it to the attacker. 
* **Zero day malware:**  
    * Zero day refers to malware which exploits a vulnerability which has not yet been patched by vendors, leaving threat actors to exploit this before a patch is made available.

## Types of Malware

Malware can be classified into three main types; viruses, trojans, and worms.

### Viruses

#### Definition

A computer virus is malicious executable code which self-propagates. That is, it multiplies itself, typically by attaching itself to what’s called a host document. 

Host documents can be
* **Executable file:** such as .exe files, Unix shell scripts, Windows batch files, and macros 
* **Office documents:** such as word files and pdfs. 

#### Lifecycle of a Virus

1. **Attachment:**
    The virus attaches itself to an uninfected host file or document.
1. **Propagation:**
    * The virus multiplies by attaching itself to more uninfected files. One of its main aims is to infect as many hosts as possible.
    * It checks if a file is already infected before attaching itself.
        * **Reason:** Repeated attachments can increase file size, making detection easier.
        * Infected files are marked using signatures (something that indicates the file has already been infected), such as impossible dates.
    * A virus may mutate as it propagates, creating polymorphic viruses.
        * **Advantage:** Mutation helps avoid detection by antivirus software, which often searches for consistent patterns across infections.
        * This makes the virus harder to identify and mitigate.
1. **Execution:**
    * When the infected host file is opened, the virus runs its code and begins propagating further.
    * Some viruses may continue running in the background even after the host program stops.

#### Components of a virus

A virus has three main parts. It has code related to concealment, propagation, and payload. 

1. **Concealment:** code to hide itself from detection such as through antivirus software. 
1. **Propagation:** code related to the need for it to find files and infect them, and add a signature as we’ve already discussed. 
1. **Payload:** the payload is any code not related to either concealment or propagation. For example, this could be things such as trying to copy data and send it back to the attacker.

#### Virus Classifiction

We can classify viruses on the basis of the trigger type or the infection mechanism

##### By Trigger Type

We can classify viruses on the basis of the trigger type. The trigger is what makes the virus payload execute. 

1. **Logic Bomb:** 
    * only triggers when specified conditions are met. 
    * For example, if an employee thinks they’re going to be fired and they insert code which checks to see if there’s been any activity on their account in the last 30 days and if not it starts to delete files.
1. **Time Bomb:** 
    * triggers at a certain date or time. 
    * For example, the Priscilla virus spread via email in an infected Word document. On the 25th of December, it would trigger, and the message was displayed, coloured blocks added to Word documents and, on the next reboot, it also attempted to reformat the hard drive.

##### By Infection Mechanism

We can also classify viruses based on the infection mechanism i.e. how it spreads itself. 

1. **File Infector:** 
    * This is where it embeds itself in an .exe and is run when the infected file is run. 
1. **Boot Sector:**
    * So it embeds itself in the boot sector of a disk, the small part of a hard disk or external storage, for example. 
    * It then becomes memory resident when the computer is booted from this, if the disk is bootable, or when the disk is inserted into a disk drive and is read. 
1. **Email Virus** 
    * where it is attached to an email. 
1. **Macro Virus:**, 
    * where it is attached in a macro, such as those used in Excel spreadsheets. 
1. **Operating System vVirus**
    * where it attaches itself to an operating system file.

### Worms

Unlike viruses, worms don’t need human interaction in order to spread. They exist on a computer as a separate program. A worm relies on a network to send copies of itself out to other machines on that network by exploiting vulnerabilities in applications and protocols. They can consume bandwidth and allow hackers to access your machine remotely. 

#### Methods of Propagation

Once the computer has been infected by the code the virus can try to replicate across the network without further user interaction. 

There are several ways of achieving this:

1. **Remote Access:** 
    * Worms may use Unix remote shell scripts like SSH, the secure network protocol, to remotely log into a Unix machine. 
    * Remote access to the target machine could be gained by cracking a password of a user and logging in as them remotely, hence infecting another machine.
1. **Exploiting Software Bugs:**
    * It could also be through bugs and networking software.

#### Examples

1. **Blaster Worm:** 
    * spread itself across networks 
    * forced computers to constantly reboot
    * eventually caused a distributed denial of service on the Windows website.
1. **Witty Worm:** 
    * thought to be the first widely-propagated internet worm which had a destructive or malicious payload. 
    * took advantage of a security flaw in firewalls to propagate
    * repeatedly deleted sections of hard drives, thus over time, rendering the machine unusable.

Worms can be used to spread spam across networks, further congesting bandwidth and delivering malicious content.

### Trojans

Trojans are distinct from viruses and worms, as they do not attempt to propagate themselves. They are innocuous computer programs which hide a virus or other potentially damaging programs, such as a key logger. 

#### Key Loggers

A key logger is a type of spyware. This means it gathers information on an infected machine and communicates it back to the attacker. In particular, a key logger logs all the keystrokes of a user. This could be sensitive information, such as usernames and passwords, and so forth.

#### RATs

Trojans often includes something called a backdoor. This gives the attackers a way to bypass normal authentication or other security mechanisms and gain remote control over the infected computer. This can be referred to as a Remote Access Trojan (RAT). RATs can often include code which helps hide the malicious activity, making it more difficult to detect.

## Malware Detection and Prevention

There are three general areas which we can explore to aid in preventing and detecting malware. Increasing user awareness can help avoid risky behaviours which could result in malware infection. For example, increased awareness resulting in avoidance of downloading questionable files from the internet.

We can also explore technical solutions – e.g. write- protect sensitive parts of disk, use of intrusion detection and prevention systems and firewalls amongst other options.

Additionally, antivirus software identifies and removes malware from an infected computer and also tries to stop it getting infected in the first place.

### Antivirus Approaches

There are several approaches to antivirus. 

#### Virus Dictionaries

One common approach is using virus dictionaries. Every file on a computer is searched for signatures associated with known viruses.

It has several limitations:
* requires end users to keep virus definitions up to date and to perform anti-virus scans regularly
* It is also unable to recognise unknown viruses which haven’t yet had a signature added to the dictionary. 
* Similarly, it has difficulty with polymorphic viruses, which encrypts parts of themselves or otherwise modify themselves, as a method of disguise so as not to match the virus signature in the dictionary.

### Integrity Checkers

Another approach is an integrity checker. Integrity checkers aim to identify changes to files as a result of viruses. So for example, a very old file which has been recently modified. It alerts the user, who then decides what to do with that file. However, there is a bit of a downside to this.

If a change has been detected, then the virus still has to be identified and located. The downside is that it can only be found when a virus has already done some damage. So in theory, the dictionary approach means that it can be detected before the damage is done. On the other hand, an integrity checker can discover the effects of a mutating virus.

### Activity Monitoring

Another approach is the activity monitoring approach. This approach involves monitoring activities of all programs and looking for suspicious behaviour, such as:
* a program trying to write executable codes to another program. 
* changing program length
* programs slowing down
* or the system taking longer to start. 

If a program exhibits suspicious behaviour then the user is alerted and asked what they want to do to it. It has the benefit of identifying new viruses, but may also flag a lot of false positives.

In the activity monitor approach the antivirus should quarantine the suspected file. This means it places the suspected file or program into a new location where it can’t impact the rest of your system. The user can either decide to remove it or restore it.

Quarantining can take a number of forms. One approach is to use a sandbox, an environment which is cornered off from the main operating system such that anything that is created or changed by the sandbox application isn’t accessible outside of the sandbox and any changes made by the application aren’t saved. So if, for example, it downloaded and installed malware, then this would be removed when the application stopped running. Another approach is to use containers such as Docker.